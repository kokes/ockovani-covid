{% macro prehled_mist(centers, days) -%}
<div class="row">
    <div class="col">
        {% if centers %}
        <div class="table-responsive">
            <table id="centers-table" class="table table-bordered table-striped table-sm">
                <thead class="thead-dark">
                <tr>
                    <th scope="col" class="text-center">Název</th>
                    <th scope="col" class="text-center">Okres</th>
                    <th scope="col" class="text-center">Kraj</th>
                    <th scope="col" class="text-center">
                        Ve frontě
                        <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto"
                           title="Počet registrovaných čekajících na rezervaci konkrétního termínu (přibližně odpovídá čekajícím na SMS s PIN2).">
                        </i>
                    </th>
                    <th scope="col" class="text-center">
                        Čekání na rezervaci
                        <i class="fas fa-exclamation-triangle" data-html="true" data-toggle="tooltip" data-placement="auto"
                           title="Průměrná doba mezi registrací a rezervací konkrétního termínu za posledních 7 dní (přibližně odpovídá čekání na SMS s PIN2).<br>Pokud přednost dostávají prioritní skupiny, odpovídá tento údaj spíše jejich čekání - ověřte si ve stavu registrací konkrétního očkovacího místa čekání pro vaši skupinu.<br>Červená (>2), žlutá (>1), zelená (>0).">
                        </i>
                    </th>
                    <th scope="col" class="text-center">
                        Naočkování registrovaných
                        <i class="fas fa-exclamation-triangle" data-html="true" data-toggle="tooltip"
                           data-placement="auto"
                           title="Odhadovaný počet týdnů potřebný k naočkování lidí ve frontě 1. dávkou při rychlostí očkování podle posledních 7 dnů. Data o očkování se doplňují zpětně a u nových míst chybí úplně, proto číslo berte jako orientační!<br>Červená (>4), žlutá (>2), zelená (>0).">
                        </i>
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for item in centers %}
                <tr class="{{ 'table-warning' if not item.status }}">
                    <td><a href="{{ url_for('view.info_misto', misto_id=item.id) }}">{{ item.nazev }}</a></td>
                    <td>
                        {% if request.path.startswith('/okres') %}
                        {{ item.okres }}
                        {% else %}
                        <a href="{{ url_for('view.info_okres', okres_name=item.okres) }}">{{ item.okres }}</a>
                        {% endif %}
                    </td>
                    <td>
                        {% if request.path.startswith('/kraj') %}
                        {{ item.kraj }}
                        {% else %}
                        <a href="{{ url_for('view.info_kraj', kraj_name=item.kraj) }}">{{ item.kraj }}</a>
                        {% endif %}
                    </td>
                    <td class="text-right">
                        {{ item.registrace_fronta | format_number }}
                    </td>
                    <td class="text-center">
                        <span class="badge badge-pill badge-{{ 'light' if item.registrace_prumer_cekani == None else 'success' if item.registrace_prumer_cekani <= 7 else 'warning' if item.registrace_prumer_cekani <= 14 else 'danger' }}">
                            {{ (None if item.registrace_prumer_cekani == None else (item.registrace_prumer_cekani / 7)) | format_decimal }} {{ 'týdne' if item.registrace_prumer_cekani != None }}
                        </span>
                    </td>
                    <td class="text-center">
                        <span class="badge badge-pill badge-{{ 'light' if item.ockovani_odhad_cekani == None else 'success' if item.ockovani_odhad_cekani <= 14 else 'warning' if item.ockovani_odhad_cekani <= 28 else 'danger' }}">
                            {{ (None if item.ockovani_odhad_cekani == None else (item.ockovani_odhad_cekani / 7)) | format_decimal }} {{ 'týdne' if item.ockovani_odhad_cekani != None }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <p class="font-italic">
            Oranžově jsou vyznačena očkovací místa, která jsou v&nbsp;současnosti skryta v rezervačním systému, ale zároveň jsou na nich čekající ve frontě nebo s&nbsp;rezervací.
        </p>
        {% else %}
        <div class="alert alert-warning w-100" role="alert">
            Zatím nemáme žádná data.
        </div>
        {% endif %}
    </div>
</div>
{%- endmacro %}


{% macro stav_vakcin(vaccines) -%}
<div class="table-responsive">
    <table class="table table-bordered table-striped table-sm mb-0">
        <thead class="thead-dark">
        <tr>
            <th scope="col" class="w-20 text-center">Výrobce</th>
            <th scope="col" class="w-20 text-center">
                Přijato
                <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet dávek přijatých na dané místo.<br>V případě přehledu kraje předpokládáme, že dávky vydané mimo očkovací místa (např. praktickým lékařům) zůstaly ve stejném kraji. Data neobsahují dávky distribuované praktickým lékařům přímo.">
                </i>
            </th>
            {% if 'pouzito' in vaccines %}
            <th scope="col" class="w-20 text-center">
                Použito
                <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet použitých dávek podle spotřeby vakcín.<br>Dataset spotřeba vakcín vykazuje velké zpoždění a nepřesnosti!">
                </i>
            </th>
            {% else %}
            <th scope="col" class="w-20 text-center">
                Očkováno
                <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet očkovaných dávek podle vykázaných očkování.<br>Dataset vykázaných očkování vykazuje velké zpoždění a nepřesnosti!">
                </i>
            </th>
            {% endif %}
            <th scope="col" class="w-20 text-center">
                Zničeno
                <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet zničených dávek podle spotřeby vakcín.<br>Dataset spotřeba vakcín vykazuje velké zpoždění a nepřesnosti!">
                </i>
            </th>
            <th scope="col" class="w-20 text-center">
                Skladem
                <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Odhadovaný počet dávek skladem.<br>Údaj je počítán z předchozích sloupců a může vykazovat velké nepřesnosti způsobené zpožděním v datech! U vakcín, které jsou distribuovány praktickým lékařům přímo, může být dokonce záporný.">
                </i>
            </th>
        </tr>
        </thead>
        <tbody>
        {% for idx, row in vaccines.iterrows() %}
        <tr>
            <td>{{ row['vyrobce'] }}</td>
            <td class="text-right">{{ row['prijato_celkem'] | format_number }}</td>
            {% if 'pouzito' in row %}
            <td class="text-right">{{ row['pouzito'] | format_number }}</td>
            {% else %}
            <td class="text-right">{{ row['ockovano'] | format_number }}</td>
            {% endif %}
            <td class="text-right">{{ row['znehodnoceno'] | format_number }}</td>
            <td class="text-right">{{ row['skladem'] | format_number }}</td>
        </tr>
        {% endfor %}
        </tbody>
        <tfoot class="font-weight-bold">
        <tr>
            <td>Celkem</td>
            <td class="text-right">{{ vaccines['prijato_celkem'].sum() | format_number }}</td>
            {% if 'pouzito' in vaccines %}
            <td class="text-right">{{ vaccines['pouzito'].sum() | format_number }}</td>
            {% else %}
            <td class="text-right">{{ vaccines['ockovano'].sum() | format_number }}</td>
            {% endif %}
            <td class="text-right">{{ vaccines['znehodnoceno'].sum() | format_number }}</td>
            <td class="text-right">{{ vaccines['skladem'].sum() | format_number }}</td>
        </tr>
        </tfoot>
    </table>
</div>
{%- endmacro %}


{% macro stav_registraci(registrations) -%}
<div class="table-responsive">
    <table class="table table-bordered table-striped table-sm mb-0" style="table-layout: fixed">
        <thead class="thead-dark">
        <tr>
            <th scope="col" class="w-15 text-center">Věková<br>skupina</th>
            <th scope="col" class="w-25 text-center">Povolání</th>
            <th scope="col" class="w-15 text-center">
                Ve frontě
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet registrovaných čekajících na rezervaci konkrétního termínu (přibližně odpovídá čekajícím na SMS s PIN2).">
                </i>
            </th>
            <th scope="col" class="w-15 text-center">
                Čekání na rezervaci
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Průměrná doba mezi registrací a rezervací konkrétního termínu za posledních 7 dní (přibližně odpovídá čekání na SMS s PIN2).<br>Červená (>2), žlutá (>1), zelená (>0).">
                </i>
            </th>
            <th scope="col" class="w-15 text-center">
                Doba ve frontě
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Průměrná doba strávená čekajícími ve frontě k dnešnímu dni.<br>Červená (>2), žlutá (>1), zelená (>0).">
                </i>
            </th>
            <th scope="col" class="w-15 text-center">
                7denní úspěšnost
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Poměr počtu registrovaných za posledních 7 dní s vybraným termínem ku počtu všech registrovaných za posledních 7 dní.<br>Zelená (>50 %), žlutá (>5 %), červená (>0 %).">
                </i>
            </th>
        </tr>
        </thead>
        <tbody>
        {% for idx, row in registrations.iterrows() %}
        <tr>
            <td>{{ row['vekova_skupina'] }}</td>
            <td class="ellipsis" data-toggle="tooltip" data-placement="auto" title="{{ row['povolani'] }}">
                {{ row['povolani'] }}
            </td>
            <td class="text-right">
                {{ row['fronta_pocet'] | format_number }}
            </td>
            <td class="text-center">
                <span class="badge badge-pill badge-{{ 'light' if row['rezervace_prumer_cekani'] == None else 'danger' if row['rezervace_prumer_cekani'] > 2 else 'warning' if row['rezervace_prumer_cekani'] > 1 else 'success' }}">
                    {{ row['rezervace_prumer_cekani'] | format_decimal }} {{ 'týdne' if row['rezervace_prumer_cekani'] != None }}
                </span>
            </td>
            <td class="text-center">
                <span class="badge badge-pill badge-{{ 'light' if row['fronta_prumer_cekani'] == None else 'danger' if row['fronta_prumer_cekani'] > 2 else 'warning' if row['fronta_prumer_cekani'] > 1 else 'success' }}">
                    {{ row['fronta_prumer_cekani'] | format_decimal }} {{ 'týdne' if row['fronta_prumer_cekani'] != None }}
                </span>
            </td>
            <td class="text-center">
                <span class="badge badge-pill badge-{{ 'light' if row['uspesnost_7'] == None else 'success' if row['uspesnost_7'] > 50 else 'warning' if row['uspesnost_7'] > 5 else 'danger' }}"
                      data-toggle="tooltip" data-placement="auto"
                      title="{{ row['registrace_7_rez'] }} / {{ row['registrace_7'] }}">
                    {{ row['uspesnost_7'] | format_number }} {{ '%' if row['uspesnost_7'] != None }}
                </span>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{%- endmacro %}


{% macro stav_ockovani(vaccinated, kraj=False) -%}
<div class="table-responsive">
    <table class="table table-bordered table-striped table-sm mb-0">
        <thead class="thead-dark">
        <tr>
            <th scope="col" class="w-20 text-center">Věková skupina</th>
            <th scope="col" class="w-20 text-center">
                Ve frontě
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto"
                   title="Počet čekajících ve frontě před závorou na SMS s PIN2 (výběr termínu).">
                </i>
            </th>
            <th scope="col" class="text-center" colspan="{{'1' if kraj else '2'}}">
                Částečně očkovaní
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet obyvatel dané věkové skupiny očkovaných alespoň jednou dávkou. Podle datasetu vykázaných očkování.">
                </i>
            </th>
            <th scope="col" class="text-center" colspan="{{'1' if kraj else '2'}}">
                Plně očkovaní
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet obyvatel dané věkové skupiny plně očkovaných (obě dávky). Podle datasetu vykázaných očkování.">
                </i>
            </th>
        </tr>
        </thead>
        <tbody>
        {% for idx, row in vaccinated.iterrows() %}
        <tr>
            <td>{{ row['vekova_skupina'] }}</td>
            <td class="text-right">{{ row['pocet_fronta'] | format_number }}</td>
            <td class="w-15 text-right">{{ row['pocet_ockovani_castecne'] | format_number }}</td>
            {% if not kraj %}
            <td class="w-15 text-right">{% if row['podil_ockovani_castecne'] %} {{ (100 * row['podil_ockovani_castecne']) | format_decimal }} % {% endif %}</td>
            {% endif %}
            <td class="w-15 text-right">{{ row['pocet_ockovani_plne'] | format_number }}</td>
            {% if not kraj %}
            <td class="w-15 text-right">{% if row['podil_ockovani_plne'] %} {{ (100 * row['podil_ockovani_plne']) | format_decimal }} % {% endif %}</td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
        <tfoot class="font-weight-bold">
        <tr>
            <td>Celkem</td>
            <td class="text-right">{{ vaccinated['pocet_fronta'].sum() | format_number }}</td>
            <td class="text-right">{{ vaccinated['pocet_ockovani_castecne'].sum() | format_number }}</td>
            {% if not kraj %}
            <td class="text-right">{{ (100 * vaccinated['pocet_ockovani_castecne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>
            {% endif %}
            <td class="text-right">{{ vaccinated['pocet_ockovani_plne'].sum() | format_number }}</td>
            {% if not kraj %}
            <td class="text-right">{{ (100 * vaccinated['pocet_ockovani_plne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>
            {% endif %}
        </tr>
        </tfoot>
    </table>
</div>
{%- endmacro %}


{% macro metrika(name, number, delta_day=None, delta_week=None, decimal=False, unit='', multiply=1, divide=1, color=None, info=None, warning=None) -%}
{% if number != None %}
<div class="col-sm-6 col-md-4 col-lg-3 px-1 pt-0 pb-2">
    <div class="card h-100">
        <div class="card-body">
            <div class="row">
                <div class="col-9 col-xl-10 pr-0">
                    <h6 class="card-title ellipsis mb-1">
                        <span data-toggle="tooltip" data-placement="auto" title="{{ name }}">
                            {{ name }}
                        </span>
                    </h6>
                </div>
                <div class="col-3 col-xl-2 pl-0 text-right">
                    <h6 class="card-title mb-1">
                        {% if info %}
                        <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                           title="{{ info }}"></i>
                        {% endif %}
                        {% if warning %}
                        <i class="fas fa-exclamation-triangle" data-toggle="tooltip" data-placement="auto"
                           data-html="true" title="{{ warning }}"></i>
                        {% endif %}
                    </h6>
                </div>
            </div>
            {% if decimal %}
            <p class="card-text text-right metrics-number">{{ ((number * multiply) / divide) | format_decimal }} {{ unit }}</p>
            <p class="card-text text-right metrics-delta">
                {% if delta_day != None %}
                {% set delta_day_mult = (delta_day * multiply) / divide %}
                <span class="{{ (delta_day_mult | number_color) if color == 'std' else ((delta_day_mult | number_color_rev) if color == 'rev' else '') }}"
                      data-toggle="tooltip" data-placement="auto" data-html="true"
                      title="Změna za 1 den<br>(rozdíl od včerejší hodnoty - zahrnuje i zpětně doplněné)">
                    {{ delta_day_mult | format_decimal_delta }}
                </span>
                {% endif %}
                {% if delta_week != None %}
                {% set delta_week_mult = (delta_week * multiply) / divide %}
                /
                <span class="{{ (delta_week_mult | number_color) if color == 'std' else ((delta_week_mult | number_color_rev) if color == 'rev' else '') }}"
                      data-toggle="tooltip" data-placement="auto" data-html="true"
                      title="Změna za 7 dní<br>(rozdíl od hodnoty před týdnem - zahrnuje i zpětně doplněné)">
                    {{ delta_week_mult | format_decimal_delta }}
                </span>
                {% endif %}
                {% if delta_day != None or delta_week != None %}
                {{ unit }}
                {% endif %}
            </p>
            {% else %}
            <p class="card-text text-right metrics-number">{{ number | format_number }} {{ unit }}</p>
            <p class="card-text text-right metrics-delta">
                {% if delta_day != None %}
                <span class="{{ (delta_day | number_color) if color == 'std' else ((delta_day | number_color_rev) if color == 'rev' else '') }}"
                      data-toggle="tooltip" data-placement="auto" data-html="true"
                      title="Změna za 1 den<br>(rozdíl od včerejší hodnoty - zahrnuje i zpětně doplněné)">
                    {{ delta_day | format_number_delta }}
                </span>
                {% endif %}
                {% if delta_week != None %}
                /
                <span class="{{ (delta_week | number_color) if color == 'std' else ((delta_week | number_color_rev) if color == 'rev' else '') }}"
                      data-toggle="tooltip" data-placement="auto" data-html="true"
                      title="Změna za 7 dní<br>(rozdíl od hodnoty před týdnem - zahrnuje i zpětně doplněné)">
                    {{ delta_week | format_number_delta }}
                </span>
                {% endif %}
                {% if delta_day != None or delta_week != None %}
                {{ unit }}
                {% endif %}
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{%- endmacro %}