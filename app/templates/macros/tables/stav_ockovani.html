{% macro stav_ockovani(vaccinated, kraj=False) -%}
{% if 'podil_ockovani_v_kraji_plne' in vaccinated %}
    {% set ockovani_enh = True %}
{% else %}
    {% set ockovani_enh = False %}
{% endif %}

<div class="table-responsive">
    <table class="table table-bordered table-striped table-sm mb-0">
        <thead class="thead-dark">
        <tr>
            <th scope="col" class="w-20 text-center">Věková skupina</th>
            <th scope="col" class="w-20 text-center">
                Ve frontě
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto"
                   title="Počet čekajících ve frontě před závorou na SMS s PIN2 (výběr termínu).">
                </i>
            </th>
            <th scope="col" class="text-center" colspan="{{'1' if (kraj and not ockovani_enh) else '2'}}">
                Částečně očkovaní
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet obyvatel dané věkové skupiny očkovaných alespoň jednou dávkou. Podle datasetu vykázaných očkování.">
                </i>
            </th>
            <th scope="col" class="text-center" colspan="{{'1' if (kraj and not ockovani_enh) else '2'}}">
                Plně očkovaní
                <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="auto" data-html="true"
                   title="Počet obyvatel dané věkové skupiny plně očkovaných (obě dávky). Podle datasetu vykázaných očkování.">
                </i>
            </th>
        </tr>
        </thead>
        <tbody>
        {% for idx, row in vaccinated.iterrows() %}
        <tr>
            <td>{{ row['vekova_skupina'] }}</td>
            <td class="text-right">{{ row['pocet_fronta'] | format_number }}</td>
            <td class="w-15 text-right">
                {% if not kraj %}
                    {{ row['pocet_ockovani_castecne'] | format_number }}
                {% else %}
                <span data-toggle="tooltip" data-placement="auto" data-html="true" title="Poměr k trvale bydlícím: {% if row['podil_ockovani_castecne'] %} {{ (100 * row['podil_ockovani_castecne']) | format_decimal }} % {% endif %} <br />10-20% lidí se očkuje mimo svůj kraj.">{{ row['pocet_ockovani_castecne'] | format_number }}</span>
                {% endif %}
            </td>
            {% if not kraj  %}
                <td class="w-15 text-right">{% if row['podil_ockovani_castecne'] %} {{ (100 * row['podil_ockovani_castecne']) | format_decimal }} % {% endif %}</td>
            {% else %}
                {% if ockovani_enh %}<td class="w-15 text-right"> <span data-toggle="tooltip" data-placement="auto" data-html="true" title="Podíl očkovaných s trvalým bydlištěm na daném území."> {% if row['podil_ockovani_v_kraji_castecne'] %}{{ (100 * row['podil_ockovani_v_kraji_castecne']) | format_decimal }} % {% endif %}</span> </td>{% endif %}
            {% endif %}
            <td class="w-15 text-right">
                {% if not kraj %}
                    {{ row['pocet_ockovani_plne'] | format_number }}
                {% else %}
                <span data-toggle="tooltip" data-placement="auto" data-html="true" title="Poměr k trvale bydlícím: {% if row['podil_ockovani_plne'] %} {{ (100 * row['podil_ockovani_plne']) | format_decimal }} % {% endif %} <br />10-20% lidí se očkuje mimo svůj kraj.">{{ row['pocet_ockovani_plne'] | format_number }}</span>
                {% endif %}
            </td>
            {% if not kraj %}
                <td class="w-15 text-right">{% if row['podil_ockovani_plne'] %} {{ (100 * row['podil_ockovani_plne']) | format_decimal }} % {% endif %}</td>
            {% else %}
                {% if ockovani_enh %}<td class="w-15 text-right"><span data-toggle="tooltip" data-placement="auto" data-html="true" title="Podíl očkovaných s trvalým bydlištěm na daném území.">{% if row['podil_ockovani_v_kraji_plne'] %}{{ (100 * row['podil_ockovani_v_kraji_plne']) | format_decimal }} % {% endif %}</span></td>{% endif %}
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
        <tfoot class="font-weight-bold">
        <tr>
            <td>Celkem</td>
            <td class="text-right">{{ vaccinated['pocet_fronta'].sum() | format_number }}</td>
            <td class="text-right">{{ vaccinated['pocet_ockovani_castecne'].sum() | format_number }}</td>
            {% if not kraj %}
                <td class="text-right">{{ (100 * vaccinated['pocet_ockovani_castecne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>
            {% else %}
                {% if ockovani_enh %}<td class="text-right">{{ (100 * vaccinated['pocet_ockovani_castecne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>{% endif %}
            {% endif %}
            <td class="text-right">{{ vaccinated['pocet_ockovani_plne'].sum() | format_number }}</td>
            {% if not kraj %}
                <td class="text-right">{{ (100 * vaccinated['pocet_ockovani_plne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>
            {% else %}
                {% if ockovani_enh %}<td class="text-right">{{ (100 * vaccinated['pocet_ockovani_plne'].sum() / vaccinated['pocet_vek'].sum()) | format_decimal }} %</td>{% endif %}
            {% endif %}
        </tr>
        </tfoot>
    </table>
</div>
{%- endmacro %}
